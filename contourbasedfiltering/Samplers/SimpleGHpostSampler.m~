function [Xpost,postprobs] = SimpleGHpostSampler(Xprior,priorprobs,probsXpost,priorpdfnorm,N1d,factor)
% Just compute posterior mX,PX and get the samples from that.
% priorprobs,probsXpost are both at the points Xprior
% N1d is the number of points in 1D

[N,dim]=size(Xprior);

%% G
[mX,PX] = MeanCov(Xprior,probsXpost/sum(probsXpost));
[XpriorNew,~] = model.pointGenerator(mX,(factor)^2*PX);

y=priorpdfnorm.transForms.trueX2normX(XpriorNew);
py=priorpdfnorm.func(y);
priorprobsNew=priorpdfnorm.transForms.normprob2trueprob(py);
logprobs = log(priorprobsNew);

pz2 = integratorFuncTrueX_usingpdfnorm(priorpdfnorm,@(x)mvnpdf(repmat(z(:)',size(x,1),1),model.h(x),model.R),'RegTreeBoxIntegrator');
logpz = log(pz2);

logprobsXpost = zeros(size(logprobs));
for i=1:size(XpriorNew,1)
    logprobsXpost(i) = log(1/sqrt(det(2*pi*model.R)))-0.5*(z(:)-model.h(XpriorNew(i,:)'))'*inv(model.R)*(z(:)-model.h(XpriorNew(i,:)'))+logprobs(i)-logpz;
end

probsXpost = exp(logprobsXpost);